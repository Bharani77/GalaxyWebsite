(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{9665:function(e,t,r){Promise.resolve().then(r.bind(r,3414))},3414:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(7437),n=r(2265),a=r(4033),o=r(3159),i=r(5925),l=r(5611),c=r(4566);let d=(0,c.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4");function u(){var e,t,r;let c=(0,a.useRouter)(),[u,x]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0),[g,f]=(0,n.useState)([]),[p,y]=(0,n.useState)([]),[w,b]=(0,n.useState)({username:"",password:""});(0,n.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("adminSession");e?(x(!0),await v()):x(!1)}catch(e){console.error("Session check error:",e),x(!1)}finally{h(!1)}};e()},[]),(0,n.useEffect)(()=>{if(!u)return;let e=d.channel("users-channel").on("postgres_changes",{event:"*",schema:"public",table:"users"},e=>{console.log("Users change received:",e),v()}).subscribe(),t=d.channel("tokens-channel").on("postgres_changes",{event:"*",schema:"public",table:"tokens"},e=>{console.log("Tokens change received:",e),v()}).subscribe();return()=>{e.unsubscribe(),t.unsubscribe()}},[u]);let v=async()=>{try{let{data:e,error:t}=await d.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;let{data:r,error:s}=await d.from("tokens").select("*").order("created_at",{ascending:!1});if(s)throw s;let n=r.map(t=>{var r;return{...t,is_used:e.some(e=>e.token===t.token),used_by:null===(r=e.find(e=>e.token===t.token))||void 0===r?void 0:r.username}});f(e||[]),y(n||[])}catch(e){console.error("Error fetching data:",e),i.default.error("Failed to refresh data")}},j=async()=>{try{let{data:e,error:t}=await d.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;f(e||[])}catch(e){console.error("Error fetching users:",e),i.default.error("Failed to refresh users")}},k=async()=>{try{let{data:e,error:t}=await d.from("tokens").select("*").order("created_at",{ascending:!1});if(t)throw t;y(e||[])}catch(e){console.error("Error fetching tokens:",e),i.default.error("Failed to refresh tokens")}},N=async e=>{e.preventDefault();try{let e=await (0,l.zB)(w.username,w.password);if(!e.isLoggedIn)throw Error("Invalid credentials");localStorage.setItem("adminSession","true"),x(!0),await v(),i.default.success("Welcome, Administrator")}catch(e){i.default.error(e.message||"Authentication failed")}},I=async e=>{try{let t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),r=new Date;switch(e){case"3month":r.setMonth(r.getMonth()+3);break;case"6month":r.setMonth(r.getMonth()+6);break;case"1year":r.setFullYear(r.getFullYear()+1)}let{error:s}=await d.from("tokens").insert([{token:t,duration:e,expiry_date:r.toISOString(),is_used:!1,created_at:new Date().toISOString()}]);if(s)throw s;i.default.success("Token generated successfully"),v()}catch(e){console.error("Error generating token:",e),i.default.error("Failed to generate token")}},S=async e=>{try{var t,r;let{data:s,error:n}=await d.from("users").select("token").eq("id",e).single();if(n)throw console.error("Error getting user data:",n),n;if(null==s?void 0:s.token){let{error:e}=await d.from("tokens").delete().eq("token",s.token);if(e)throw console.error("Error deleting token:",e),e}let{error:a}=await d.from("users").delete().eq("id",e);if(a)throw a;let o=await d.auth.getSession(),l=null==o?void 0:null===(r=o.data)||void 0===r?void 0:null===(t=r.session)||void 0===t?void 0:t.user;if(l&&l.id===e){await d.auth.signOut(),c.push("/");return}i.default.success("User and associated token deleted successfully"),v()}catch(e){console.error("Error deleting user:",e),i.default.error("Failed to delete user")}},_=async(e,t)=>{try{var r,s;console.log("Deleting token:",t,"for user:",e);let{data:n,error:a}=await d.from("tokens").select("id").eq("token",t).single();if(a)throw console.error("Error finding token:",a),a;console.log("Found token data:",n);let{error:o}=await d.from("users").update({token:""}).eq("id",e);if(o)throw console.error("Error updating user:",o),o;console.log("Updated user token to empty string");let{error:l}=await d.from("tokens").delete().eq("id",n.id);if(l)throw console.error("Error deleting token:",l),l;console.log("Deleted token successfully");let u=await d.auth.getSession(),x=null==u?void 0:null===(s=u.data)||void 0===s?void 0:null===(r=s.session)||void 0===r?void 0:r.user;if(x&&x.id===e){console.log("Admin deleted their own token, logging out..."),await d.auth.signOut(),c.push("/");return}i.default.success("Token deleted successfully"),await j(),await k()}catch(e){console.error("Failed to delete token:",e),i.default.error("Failed to delete token: "+(e.message||"Unknown error"))}},E=async e=>{try{let{error:t}=await d.from("tokens").delete().eq("id",e);if(t)throw t;i.default.success("Token deleted successfully"),k()}catch(e){console.error("Error deleting unused token:",e),i.default.error("Failed to delete token")}},D=async(e,t,r)=>{try{let s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),n=new Date;switch(r){case"3month":n.setMonth(n.getMonth()+3);break;case"6month":n.setMonth(n.getMonth()+6);break;case"1year":n.setFullYear(n.getFullYear()+1)}if(t){let{error:e}=await d.from("tokens").delete().eq("token",t);if(e)throw e}let{error:a}=await d.from("tokens").insert([{token:s,duration:r,expiry_date:n.toISOString(),is_used:!0,created_at:new Date().toISOString()}]);if(a)throw a;let{error:o}=await d.from("users").update({token:s}).eq("id",e);if(o)throw o;i.default.success("Token renewed successfully"),v()}catch(e){console.error("Error renewing token:",e),i.default.error("Failed to renew token")}},C=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),[M,z]=(0,n.useState)("3month"),[O,A]=(0,n.useState)(null),T=async()=>{try{let{data:e,error:t}=await d.from("users").select("*").not("token","is",null);if(t)throw t;let r=new Date().getTime();for(let t of e)if(t.token&&t.expiry_date){let e=new Date(t.expiry_date).getTime();if(r>e){console.log("Token expired for user: ".concat(t.username));let{error:e}=await d.from("users").update({token:null,expiry_date:null}).eq("id",t.id);e&&console.error("Error updating expired token:",e);let{error:r}=await d.from("tokens").delete().eq("token",t.token);r&&console.error("Error deleting expired token:",r)}}}catch(e){console.error("Error handling expired tokens:",e)}};if((0,n.useEffect)(()=>{T();let e=setInterval(T,6e4);return()=>clearInterval(e)},[]),m)return(0,s.jsx)("main",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"gaming-card max-w-md w-full mx-auto space-y-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-red-500 mb-2",children:"Admin Access"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Secure administration portal"})]}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-gray-400",children:"Loading..."})})]})});if(!u)return(0,s.jsx)("main",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"gaming-card max-w-md w-full mx-auto space-y-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-red-500 mb-2",children:"Admin Access"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Secure administration portal"})]}),(0,s.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-red-400 mb-2",children:[(0,s.jsx)(o.KE5,{}),"Username"]}),(0,s.jsx)("input",{type:"text",className:"gaming-input",value:w.username,onChange:e=>b({...w,username:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-red-400 mb-2",children:[(0,s.jsx)(o.kUi,{}),"Password"]}),(0,s.jsx)("input",{type:"password",className:"gaming-input",value:w.password,onChange:e=>b({...w,password:e.target.value}),required:!0})]}),(0,s.jsx)("button",{type:"submit",className:"gaming-button w-full",children:"Access Control Center"})]})]})});let q=p.reduce((e,t)=>{let r=t.duration;return e[r]||(e[r]=[]),e[r].push(t),e},{});return(0,s.jsx)("main",{className:"min-h-screen p-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,s.jsx)("div",{className:"gaming-card",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(o.KE5,{className:"text-blue-400 text-4xl"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-red-400 relative",children:["Admin Control Center",(0,s.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-blue-500 via-red-500 to-blue-500 rounded-full shadow-lg"})]}),(0,s.jsx)("p",{className:"text-gray-400",children:"Manage users and tokens"})]})]}),(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("adminSession"),x(!1),f([]),y([]),i.default.success("Logged out successfully")},className:"gaming-button px-4 py-2 bg-black/30 hover:bg-black/40 border border-blue-500/50",children:"Logout"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[300px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-red-400",children:"3 Month Tokens"}),(0,s.jsx)("button",{onClick:()=>I("3month"),className:"gaming-button px-4 py-2",children:"Generate"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,s.jsx)("div",{className:"space-y-2",children:null===(e=q["3month"])||void 0===e?void 0:e.map(e=>{let t=e.is_used;return(0,s.jsx)("div",{className:"bg-black/30 p-3 rounded-lg text-sm ".concat(t?"border border-red-500/50":"border border-green-500/50"),children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:t?"text-red-500":"text-green-500",children:e.token}),(0,s.jsxs)("p",{className:"text-sm ".concat(t?"text-red-400":"text-gray-400"),children:["Status: ",t?"Used":"Available"]}),(0,s.jsxs)("p",{className:"text-gray-400",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),e.used_by&&(0,s.jsxs)("p",{className:"text-red-400 text-sm",children:["Used by: ",e.used_by]})]}),!t&&(0,s.jsx)("button",{onClick:()=>E(e.id),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:(0,s.jsx)(o.Xm5,{})})]})},e.id)})})})]}),(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[300px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-red-400",children:"6 Month Tokens"}),(0,s.jsx)("button",{onClick:()=>I("6month"),className:"gaming-button px-4 py-2",children:"Generate"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,s.jsx)("div",{className:"space-y-2",children:null===(t=q["6month"])||void 0===t?void 0:t.map(e=>{let t=e.is_used;return(0,s.jsx)("div",{className:"bg-black/30 p-3 rounded-lg text-sm ".concat(t?"border border-red-500/50":"border border-green-500/50"),children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:t?"text-red-500":"text-green-500",children:e.token}),(0,s.jsxs)("p",{className:"text-sm ".concat(t?"text-red-400":"text-gray-400"),children:["Status: ",t?"Used":"Available"]}),(0,s.jsxs)("p",{className:"text-gray-400",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),e.used_by&&(0,s.jsxs)("p",{className:"text-red-400 text-sm",children:["Used by: ",e.used_by]})]}),!t&&(0,s.jsx)("button",{onClick:()=>E(e.id),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:(0,s.jsx)(o.Xm5,{})})]})},e.id)})})})]}),(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[300px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-red-400",children:"1 Year Tokens"}),(0,s.jsx)("button",{onClick:()=>I("1year"),className:"gaming-button px-4 py-2",children:"Generate"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,s.jsx)("div",{className:"space-y-2",children:null===(r=q["1year"])||void 0===r?void 0:r.map(e=>{let t=e.is_used;return(0,s.jsx)("div",{className:"bg-black/30 p-3 rounded-lg text-sm ".concat(t?"border border-red-500/50":"border border-green-500/50"),children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:t?"text-red-500":"text-green-500",children:e.token}),(0,s.jsxs)("p",{className:"text-sm ".concat(t?"text-red-400":"text-gray-400"),children:["Status: ",t?"Used":"Available"]}),(0,s.jsxs)("p",{className:"text-gray-400",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),e.used_by&&(0,s.jsxs)("p",{className:"text-red-400 text-sm",children:["Used by: ",e.used_by]})]}),!t&&(0,s.jsx)("button",{onClick:()=>E(e.id),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:(0,s.jsx)(o.Xm5,{})})]})},e.id)})})})]})]}),(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[400px] flex flex-col",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-red-400 mb-6",children:"Users & Tokens Management"}),(0,s.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,s.jsxs)("table",{className:"w-full text-left",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-red-500/20",children:[(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"S.No"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Username"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Duration"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Token"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Expire Date"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Created At"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap",children:"User Status"}),(0,s.jsx)("th",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:"Token Expiry"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Device ID"}),(0,s.jsx)("th",{className:"px-4 py-2 text-red-400",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:g.map((e,t)=>{let r=p.find(t=>t.token===e.token),n=O===e.id;return(0,s.jsxs)("tr",{className:"border-b border-red-500/10 ".concat(e.token&&new Date(e.expiry_date)>new Date?"text-green-500":""),children:[(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:t+1}),(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:e.username}),(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:(null==r?void 0:r.duration)||"-"}),(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:e.token||"-"}),(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:(null==r?void 0:r.expiry_date)?(0,s.jsx)("span",{className:new Date(r.expiry_date)<new Date?"text-red-500":"",children:new Date(r.expiry_date).toLocaleDateString()}):"N/A"}),(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:C(e.created_at)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.token?new Date(e.expiry_date)<new Date?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.token?new Date(e.expiry_date)<new Date?"Expired":"Active":"No Access"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.expiry_date?(0,s.jsx)("span",{className:new Date(e.expiry_date)<new Date?"text-red-500":"",children:new Date(e.expiry_date).toLocaleDateString()}):"N/A"}),(0,s.jsx)("td",{className:"px-4 py-2 text-gray-400",children:(0,s.jsx)("span",{className:"font-mono text-xs break-all",children:e.device_fingerprint||"Not registered"})}),(0,s.jsxs)("td",{className:"px-4 py-2 space-x-2 flex items-center",children:[(0,s.jsx)("button",{onClick:()=>S(e.id),className:"text-red-500 hover:text-red-400",title:"Delete User",children:(0,s.jsx)(o.Xm5,{})}),e.token&&""!==e.token&&(0,s.jsx)("button",{onClick:()=>_(e.id,e.token),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:(0,s.jsx)(o.q2z,{})}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{onClick:()=>A(n?null:e.id),className:"text-yellow-500 hover:text-yellow-400",title:"Renew Token",children:(0,s.jsx)(o.lbL,{})}),n&&(0,s.jsxs)("div",{className:"absolute z-10 mt-2 w-48 bg-black/90 rounded-lg shadow-lg p-2 right-0",children:[(0,s.jsxs)("select",{value:M,onChange:e=>z(e.target.value),className:"w-full mb-2 bg-black/50 text-gray-300 rounded p-1 border border-gray-700",children:[(0,s.jsx)("option",{value:"3month",children:"3 Months"}),(0,s.jsx)("option",{value:"6month",children:"6 Months"}),(0,s.jsx)("option",{value:"1year",children:"1 Year"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("button",{onClick:()=>{D(e.id,e.token,M),A(null)},className:"bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-1 rounded text-sm",children:"Renew"}),(0,s.jsx)("button",{onClick:()=>A(null),className:"bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm",children:"Cancel"})]})]})]})]})]},e.id)})})]})})]})]})})}},5611:function(e,t,r){"use strict";r.d(t,{bV:function(){return y},Gg:function(){return f},zB:function(){return x},w7:function(){return h},y1:function(){return m}});var s=r(4566),n=r(225),a=r(517);let o=null,i=async()=>{if(o)return o;try{let e=await a.ZP.load(),t=await e.get();return o=t.visitorId}catch(e){throw console.error("Error generating fingerprint:",e),Error("Failed to generate device fingerprint")}},l=(0,s.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4"),c=(0,s.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczMjM1MDMwMywiZXhwIjoyMDQ3OTI2MzAzfQ.50LNYYbfszw6IzHma3S6SIL53ZGFfVpj0Ty1x3ycj0o",{auth:{autoRefreshToken:!1,persistSession:!1}});async function d(e,t){try{console.log("Creating new session for user:",e);let r=(0,n.Z)(),{error:s}=await c.from("sessions").update({is_active:!1}).eq("user_id",e);if(s)throw console.error("Error deactivating existing sessions:",s),Error("Failed to deactivate existing sessions");await new Promise(e=>setTimeout(e,500));let{error:a}=await c.from("sessions").insert([{user_id:e,session_id:r,device_fingerprint:t,is_active:!0,created_at:new Date().toISOString(),last_active:new Date().toISOString()}]);if(a)throw console.error("Error creating session:",a),Error("Failed to create session");let{data:o,error:i}=await c.from("sessions").select("*").eq("user_id",e).eq("is_active",!0);if(i)throw console.error("Error checking active sessions:",i),Error("Failed to verify session creation");if(!o||0===o.length)throw Error("Failed to create session - no active sessions found");if(o.length>1){let t=o.reduce((e,t)=>new Date(t.created_at)>new Date(e.created_at)?t:e);if(await c.from("sessions").update({is_active:!1}).eq("user_id",e).neq("id",t.id),t.session_id!==r)throw Error("Another session was created simultaneously")}return console.log("Successfully created session with ID:",r),r}catch(e){throw console.error("Session creation error:",e),e}}async function u(e,t){try{console.log("Validating session:",{sessionId:e,userId:t});let r=await i(),{data:s,error:n}=await c.from("sessions").select("*").eq("session_id",e).eq("user_id",t).eq("is_active",!0).single();if(n)return console.error("Session validation error:",n),!1;if(!s)return console.log("No active session found"),!1;if(s.device_fingerprint!==r)return console.log("Device fingerprint mismatch"),await c.from("sessions").update({is_active:!1}).eq("session_id",e),!1;console.log("Found active session:",s);let{error:a}=await c.from("sessions").update({last_active:new Date().toISOString()}).eq("session_id",e);return a&&console.error("Error updating last_active:",a),!0}catch(e){return console.error("Unexpected error in validateSession:",e),!1}}async function x(e,t){try{let r;console.log("Starting sign in process for username:",e);let s=await i();if(console.log("Device fingerprint:",s),"Bharani"===e){if("HackerBharani"===t){let t=(0,n.Z)(),r={username:e,isLoggedIn:!0,isAdmin:!0,deviceFingerprint:s,sessionId:t,userId:"admin"};return g(r),r}throw Error("Invalid username or password")}let{data:a,error:o}=await l.from("users").select("*").eq("username",e).single();if(o||!a)throw console.error("User lookup error:",o),Error("Invalid username or password");let{data:u,error:x}=await c.from("sessions").select("*").eq("user_id",a.id).eq("is_active",!0);if(x)console.error("Error checking existing sessions:",x);else if(u&&u.length>0){let e=u[0];if(e.device_fingerprint!==s)throw Error("You are already logged in from another browser. Please sign out there first.")}try{r=await d(a.id,s),console.log("Created new session:",r)}catch(e){throw console.error("Failed to create session:",e),Error("Failed to create session. Please try again.")}let m={username:a.username,userId:a.id,isLoggedIn:!0,sessionId:r,token:a.token,deviceFingerprint:s,tokenExpiry:a.token_expiry};return g(m),m}catch(e){throw console.error("Sign in error:",e),e}}async function m(e,t,r){try{console.log("Starting sign up process for username:",e);let s=await i();console.log("Generated device fingerprint:",s);let{data:n,error:a}=await l.from("users").select("username").eq("username",e).single();if(a&&console.error("Error checking existing user:",a),n)throw Error("Username already exists");let{data:o,error:c}=await l.from("tokens").select("*").eq("token",r).single();if(c)throw console.error("Token verification error:",c),Error("Invalid token");if(!o)throw Error("Invalid token");if(o.is_used)throw Error("Token has already been used");let d={username:e,password:t,token:r,device_fingerprint:s,created_at:new Date().toISOString(),token_expiry:o.expiry_date};console.log("Attempting to create user with data:",{...d,password:"[REDACTED]",token:"[REDACTED]"});let{data:u,error:x}=await l.from("users").insert([d]).select().single();if(x)throw console.error("Detailed error creating user:",{message:x.message,details:x.details,hint:x.hint,code:x.code}),Error("Failed to create user account: ".concat(x.message));let{error:m}=await l.from("tokens").update({is_used:!0,used_by:e}).eq("token",r);return m&&console.error("Error updating token status:",m),console.log("Successfully created user:",{...u,password:"[REDACTED]",token:"[REDACTED]"}),{user:u,error:null}}catch(e){throw console.error("Sign up error:",e),e}}async function h(){try{let e=f();if((null==e?void 0:e.sessionId)&&(null==e?void 0:e.userId)){let{error:t}=await c.from("sessions").update({is_active:!1}).eq("session_id",e.sessionId).eq("user_id",e.userId);t&&console.error("Error ending session:",t)}}catch(e){console.error("Error during sign out:",e)}finally{p()}}function g(e){try{localStorage.setItem("session",JSON.stringify(e))}catch(e){console.error("Error saving session:",e)}}function f(){try{let e=localStorage.getItem("session");if(!e)return null;return JSON.parse(e)}catch(e){return console.error("Error reading session:",e),null}}function p(){localStorage.removeItem("session")}async function y(){let e=f();if(!e||!e.isLoggedIn)return null;if(e.isAdmin)return"Bharani"===e.username?e:(p(),null);try{console.log("Checking session for user:",e.username);let{data:t,error:r}=await l.from("users").select("*").eq("username",e.username).single();if(r){if(console.error("User lookup error:",r),"PGRST116"!==r.code)return e;throw p(),Error("Failed to verify user access")}if(!t)throw p(),Error("User not found or access revoked");let{data:s,error:n}=await l.from("tokens").select("*").eq("token",t.token).single();if(n&&(console.error("Token lookup error:",n),"PGRST116"!==n.code))return e;if(!s)throw p(),Error("Invalid token. Please contact admin.");let a=new Date(s.expiry_date);if(a<new Date)throw p(),Error("Your access token has expired. Please contact admin for renewal.");if(!s.is_used)throw p(),Error("Your token has been deactivated. Please contact admin to reactivate.");if(e.sessionId&&e.userId){let t=await u(e.sessionId,e.userId);if(!t)return console.warn("Session validation failed, but keeping session active"),e}let o={...e,username:t.username,userId:t.id,isLoggedIn:!0,isAdmin:!1,token:t.token,deviceFingerprint:e.deviceFingerprint};return g(o),o}catch(e){throw console.error("Session check error:",e),(e.message.includes("revoked")||e.message.includes("expired")||e.message.includes("deactivated"))&&p(),e}}},4033:function(e,t,r){e.exports=r(94)},1172:function(e,t,r){"use strict";r.d(t,{w_:function(){return l}});var s=r(2265),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=s.createContext&&s.createContext(n),o=function(){return(o=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},i=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)0>t.indexOf(s[n])&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]]);return r};function l(e){return function(t){return s.createElement(c,o({attr:o({},e.attr)},t),function e(t){return t&&t.map(function(t,r){return s.createElement(t.tag,o({key:r},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var r,n=e.attr,a=e.size,l=e.title,c=i(e,["attr","size","title"]),d=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),s.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,c,{className:r,style:o(o({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&s.createElement("title",null,l),e.children)};return void 0!==a?s.createElement(a.Consumer,null,function(e){return t(e)}):t(n)}}},function(e){e.O(0,[420,638,971,472,744],function(){return e(e.s=9665)}),_N_E=e.O()}]);