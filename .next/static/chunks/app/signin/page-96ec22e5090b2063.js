(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[281],{2990:function(e,r,s){Promise.resolve().then(s.bind(s,8874))},8874:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return f}});var a=s(7437),t=s(9738),o=s.n(t),n=s(2265),i=s(1396),l=s.n(i),c=s(3159),d=s(5925),u=s(5611);function f(){let[e,r]=(0,n.useState)({username:"",password:""}),[s,t]=(0,n.useState)(!1),[i,f]=(0,n.useState)(!0),[m,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=(0,u.Gg)();(null==e?void 0:e.isLoggedIn)&&(t(!0),r(r=>({...r,username:e.username})),p(e.tokenExpiry||null)),f(!1)},[]);let g=async s=>{s.preventDefault(),f(!0);try{if(!e.username||!e.password)throw Error("Please enter both username and password");console.log("Attempting sign in with:",{username:e.username});let r=await (0,u.zB)(e.username,e.password);if(console.log("Sign in response:",r),null==r?void 0:r.isLoggedIn)t(!0),p(r.tokenExpiry||null),d.default.success("Welcome ".concat(e.username," to Galaxy KickLock Universe!"),{duration:5e3,icon:"\uD83D\uDE80",style:{background:"rgba(139, 92, 246, 0.9)",color:"#fff",padding:"16px",borderRadius:"8px",backdropFilter:"blur(8px)"}});else throw Error("Invalid login response")}catch(e){console.error("Sign in error:",e),e.message.includes("token")?d.default.error("Token-related error: "+e.message,{duration:5e3,icon:"⚠️",style:{background:"rgba(239, 68, 68, 0.9)",color:"#fff",padding:"16px",borderRadius:"8px",backdropFilter:"blur(8px)"}}):d.default.error(e.message||"An error occurred during sign in",{duration:5e3,icon:"⚠️",style:{background:"rgba(239, 68, 68, 0.9)",color:"#fff",padding:"16px",borderRadius:"8px",backdropFilter:"blur(8px)"}}),r(e=>({...e,password:""}))}finally{f(!1)}},x=async()=>{await (0,u.w7)(),t(!1),r({username:"",password:""}),p(null),d.default.success("Signed out successfully")};return i?(0,a.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-black",children:(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990 min-h-screen flex flex-col items-center justify-center bg-black p-4",children:[(0,a.jsx)("div",{className:"jsx-aa3e7887f27f1990 fixed inset-0 overflow-hidden",children:[...Array(50)].map((e,r)=>(0,a.jsx)("div",{style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),animationDelay:"".concat(3*Math.random(),"s")},className:"jsx-aa3e7887f27f1990 star"},r))}),s?(0,a.jsx)("div",{className:"jsx-aa3e7887f27f1990 relative z-10 w-full max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990 flex flex-col items-center space-y-4 p-6 bg-purple-900/20 rounded-2xl backdrop-blur-lg border border-purple-500/30",children:[(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990 text-center",children:[(0,a.jsx)("h2",{className:"jsx-aa3e7887f27f1990 text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mb-2",children:"Welcome to Galaxy KickLock Universe"}),(0,a.jsx)("p",{className:"jsx-aa3e7887f27f1990 text-xl text-purple-300 mb-1",children:e.username}),m&&(0,a.jsxs)("p",{className:"jsx-aa3e7887f27f1990 text-sm text-purple-400/80",children:["Access Valid Until: ",new Date(m).toLocaleString()]})]}),(0,a.jsxs)("button",{onClick:x,className:"jsx-aa3e7887f27f1990 group relative inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-500/20 to-purple-500/20 hover:from-red-500/30 hover:to-purple-500/30 text-red-400 rounded-lg backdrop-blur-sm transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/20",children:[(0,a.jsx)(c.fHX,{className:"group-hover:rotate-180 transition-transform duration-300"}),(0,a.jsx)("span",{className:"jsx-aa3e7887f27f1990",children:"Sign Out"}),(0,a.jsx)("div",{className:"jsx-aa3e7887f27f1990 absolute inset-0 rounded-lg bg-gradient-to-r from-red-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]})}):(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990 relative z-10 gaming-card max-w-md w-full mx-auto",children:[(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990 text-center mb-8",children:[(0,a.jsx)("h1",{className:"jsx-aa3e7887f27f1990 text-4xl font-bold text-purple-400 mb-2",children:"Welcome Back"}),(0,a.jsx)("p",{className:"jsx-aa3e7887f27f1990 text-gray-400",children:"Sign in to your account"})]}),(0,a.jsxs)("form",{onSubmit:g,className:"jsx-aa3e7887f27f1990 space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990",children:[(0,a.jsxs)("label",{className:"jsx-aa3e7887f27f1990 flex items-center gap-2 text-purple-300 mb-2",children:[(0,a.jsx)(c.m9R,{}),"Username"]}),(0,a.jsx)("input",{type:"text",value:e.username,onChange:s=>r({...e,username:s.target.value}),placeholder:"Enter your username",required:!0,className:"jsx-aa3e7887f27f1990 gaming-input"})]}),(0,a.jsxs)("div",{className:"jsx-aa3e7887f27f1990",children:[(0,a.jsxs)("label",{className:"jsx-aa3e7887f27f1990 flex items-center gap-2 text-purple-300 mb-2",children:[(0,a.jsx)(c.kUi,{}),"Password"]}),(0,a.jsx)("input",{type:"password",value:e.password,onChange:s=>r({...e,password:s.target.value}),placeholder:"Enter your password",required:!0,className:"jsx-aa3e7887f27f1990 gaming-input"})]}),(0,a.jsx)("button",{type:"submit",disabled:i,className:"jsx-aa3e7887f27f1990 gaming-button w-full relative group",children:i?(0,a.jsx)("div",{className:"jsx-aa3e7887f27f1990 flex items-center justify-center",children:(0,a.jsx)("div",{className:"jsx-aa3e7887f27f1990 w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})}):(0,a.jsx)("span",{className:"jsx-aa3e7887f27f1990",children:"Sign In"})})]}),(0,a.jsx)("div",{className:"jsx-aa3e7887f27f1990 text-center mt-6",children:(0,a.jsxs)("p",{className:"jsx-aa3e7887f27f1990 text-gray-400",children:["Don't have an account?"," ",(0,a.jsx)(l(),{href:"/signup",className:"text-purple-400 hover:text-purple-300",children:"Sign up"})]})})]}),(0,a.jsx)(o(),{id:"aa3e7887f27f1990",children:".star.jsx-aa3e7887f27f1990{position:absolute;width:2px;height:2px;background:white;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:twinkle 3s infinite;-moz-animation:twinkle 3s infinite;-o-animation:twinkle 3s infinite;animation:twinkle 3s infinite}@-webkit-keyframes twinkle{0%,100%{opacity:0;-webkit-transform:scale(.5);transform:scale(.5)}50%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@-moz-keyframes twinkle{0%,100%{opacity:0;-moz-transform:scale(.5);transform:scale(.5)}50%{opacity:1;-moz-transform:scale(1);transform:scale(1)}}@-o-keyframes twinkle{0%,100%{opacity:0;-o-transform:scale(.5);transform:scale(.5)}50%{opacity:1;-o-transform:scale(1);transform:scale(1)}}@keyframes twinkle{0%,100%{opacity:0;-webkit-transform:scale(.5);-moz-transform:scale(.5);-o-transform:scale(.5);transform:scale(.5)}50%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}"})]})}},5611:function(e,r,s){"use strict";s.d(r,{bV:function(){return w},Gg:function(){return x},zB:function(){return f},w7:function(){return p},y1:function(){return m}});var a=s(4566),t=s(225),o=s(517);let n=null,i=async()=>{if(n)return n;try{let e=await o.ZP.load(),r=await e.get();return n=r.visitorId}catch(e){throw console.error("Error generating fingerprint:",e),Error("Failed to generate device fingerprint")}},l=(0,a.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4"),c=(0,a.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczMjM1MDMwMywiZXhwIjoyMDQ3OTI2MzAzfQ.50LNYYbfszw6IzHma3S6SIL53ZGFfVpj0Ty1x3ycj0o",{auth:{autoRefreshToken:!1,persistSession:!1}});async function d(e,r){try{console.log("Creating new session for user:",e);let s=(0,t.Z)(),{error:a}=await c.from("sessions").update({is_active:!1}).eq("user_id",e);if(a)throw console.error("Error deactivating existing sessions:",a),Error("Failed to deactivate existing sessions");await new Promise(e=>setTimeout(e,500));let{error:o}=await c.from("sessions").insert([{user_id:e,session_id:s,device_fingerprint:r,is_active:!0,created_at:new Date().toISOString(),last_active:new Date().toISOString()}]);if(o)throw console.error("Error creating session:",o),Error("Failed to create session");let{data:n,error:i}=await c.from("sessions").select("*").eq("user_id",e).eq("is_active",!0);if(i)throw console.error("Error checking active sessions:",i),Error("Failed to verify session creation");if(!n||0===n.length)throw Error("Failed to create session - no active sessions found");if(n.length>1){let r=n.reduce((e,r)=>new Date(r.created_at)>new Date(e.created_at)?r:e);if(await c.from("sessions").update({is_active:!1}).eq("user_id",e).neq("id",r.id),r.session_id!==s)throw Error("Another session was created simultaneously")}return console.log("Successfully created session with ID:",s),s}catch(e){throw console.error("Session creation error:",e),e}}async function u(e,r){try{console.log("Validating session:",{sessionId:e,userId:r});let s=await i(),{data:a,error:t}=await c.from("sessions").select("*").eq("session_id",e).eq("user_id",r).eq("is_active",!0).single();if(t)return console.error("Session validation error:",t),!1;if(!a)return console.log("No active session found"),!1;if(a.device_fingerprint!==s)return console.log("Device fingerprint mismatch"),await c.from("sessions").update({is_active:!1}).eq("session_id",e),!1;console.log("Found active session:",a);let{error:o}=await c.from("sessions").update({last_active:new Date().toISOString()}).eq("session_id",e);return o&&console.error("Error updating last_active:",o),!0}catch(e){return console.error("Unexpected error in validateSession:",e),!1}}async function f(e,r){try{let s;console.log("Starting sign in process for username:",e);let a=await i();if(console.log("Device fingerprint:",a),"Bharani"===e){if("HackerBharani"===r){let r=(0,t.Z)(),s={username:e,isLoggedIn:!0,isAdmin:!0,deviceFingerprint:a,sessionId:r,userId:"admin"};return g(s),s}throw Error("Invalid username or password")}let{data:o,error:n}=await l.from("users").select("*").eq("username",e).single();if(n||!o)throw console.error("User lookup error:",n),Error("Invalid username or password");let{data:u,error:f}=await c.from("sessions").select("*").eq("user_id",o.id).eq("is_active",!0);if(f)console.error("Error checking existing sessions:",f);else if(u&&u.length>0){let e=u[0];if(e.device_fingerprint!==a)throw Error("You are already logged in from another browser. Please sign out there first.")}try{s=await d(o.id,a),console.log("Created new session:",s)}catch(e){throw console.error("Failed to create session:",e),Error("Failed to create session. Please try again.")}let m={username:o.username,userId:o.id,isLoggedIn:!0,sessionId:s,token:o.token,deviceFingerprint:a,tokenExpiry:o.token_expiry};return g(m),m}catch(e){throw console.error("Sign in error:",e),e}}async function m(e,r,s){try{console.log("Starting sign up process for username:",e);let a=await i();console.log("Generated device fingerprint:",a);let{data:t,error:o}=await l.from("users").select("username").eq("username",e).single();if(o&&console.error("Error checking existing user:",o),t)throw Error("Username already exists");let{data:n,error:c}=await l.from("tokens").select("*").eq("token",s).single();if(c)throw console.error("Token verification error:",c),Error("Invalid token");if(!n)throw Error("Invalid token");if(n.is_used)throw Error("Token has already been used");let d={username:e,password:r,token:s,device_fingerprint:a,created_at:new Date().toISOString(),token_expiry:n.expiry_date};console.log("Attempting to create user with data:",{...d,password:"[REDACTED]",token:"[REDACTED]"});let{data:u,error:f}=await l.from("users").insert([d]).select().single();if(f)throw console.error("Detailed error creating user:",{message:f.message,details:f.details,hint:f.hint,code:f.code}),Error("Failed to create user account: ".concat(f.message));let{error:m}=await l.from("tokens").update({is_used:!0,used_by:e}).eq("token",s);return m&&console.error("Error updating token status:",m),console.log("Successfully created user:",{...u,password:"[REDACTED]",token:"[REDACTED]"}),{user:u,error:null}}catch(e){throw console.error("Sign up error:",e),e}}async function p(){try{let e=x();if((null==e?void 0:e.sessionId)&&(null==e?void 0:e.userId)){let{error:r}=await c.from("sessions").update({is_active:!1}).eq("session_id",e.sessionId).eq("user_id",e.userId);r&&console.error("Error ending session:",r)}}catch(e){console.error("Error during sign out:",e)}finally{h()}}function g(e){try{localStorage.setItem("session",JSON.stringify(e))}catch(e){console.error("Error saving session:",e)}}function x(){try{let e=localStorage.getItem("session");if(!e)return null;return JSON.parse(e)}catch(e){return console.error("Error reading session:",e),null}}function h(){localStorage.removeItem("session")}async function w(){let e=x();if(!e||!e.isLoggedIn)return null;if(e.isAdmin)return"Bharani"===e.username?e:(h(),null);try{console.log("Checking session for user:",e.username);let{data:r,error:s}=await l.from("users").select("*").eq("username",e.username).single();if(s){if(console.error("User lookup error:",s),"PGRST116"!==s.code)return e;throw h(),Error("Failed to verify user access")}if(!r)throw h(),Error("User not found or access revoked");let{data:a,error:t}=await l.from("tokens").select("*").eq("token",r.token).single();if(t&&(console.error("Token lookup error:",t),"PGRST116"!==t.code))return e;if(!a)throw h(),Error("Invalid token. Please contact admin.");let o=new Date(a.expiry_date);if(o<new Date)throw h(),Error("Your access token has expired. Please contact admin for renewal.");if(!a.is_used)throw h(),Error("Your token has been deactivated. Please contact admin to reactivate.");if(e.sessionId&&e.userId){let r=await u(e.sessionId,e.userId);if(!r)return console.warn("Session validation failed, but keeping session active"),e}let n={...e,username:r.username,userId:r.id,isLoggedIn:!0,isAdmin:!1,token:r.token,deviceFingerprint:e.deviceFingerprint};return g(n),n}catch(e){throw console.error("Session check error:",e),(e.message.includes("revoked")||e.message.includes("expired")||e.message.includes("deactivated"))&&h(),e}}}},function(e){e.O(0,[420,638,326,915,971,472,744],function(){return e(e.s=2990)}),_N_E=e.O()}]);