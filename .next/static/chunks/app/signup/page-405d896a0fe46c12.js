(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{3063:function(e,r,t){Promise.resolve().then(t.bind(t,6878))},6878:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return l}});var s=t(7437),n=t(2265),o=t(4033),i=t(3159),a=t(5925),c=t(5611);function l(){let e=(0,o.useRouter)(),[r,t]=(0,n.useState)({username:"",password:"",token:""}),[l,u]=(0,n.useState)(!1),d=async t=>{t.preventDefault(),u(!0);try{if(!r.username||!r.password||!r.token)throw Error("Please fill in all fields");let{user:t,error:s}=await (0,c.y1)(r.username,r.password,r.token);if(s)throw s;a.default.success("Sign up successful! You can now sign in.",{duration:5e3,icon:"\uD83D\uDE80",style:{background:"rgba(139, 92, 246, 0.9)",color:"#fff",padding:"16px",borderRadius:"8px",backdropFilter:"blur(8px)"}}),e.push("/signin")}catch(e){console.error("Sign up error:",e),a.default.error(e.message||"Failed to sign up",{duration:5e3,icon:"⚠️",style:{background:"rgba(239, 68, 68, 0.9)",color:"#fff",padding:"16px",borderRadius:"8px",backdropFilter:"blur(8px)"}})}finally{u(!1)}};return(0,s.jsxs)("main",{className:"min-h-screen flex items-center justify-center bg-black p-4",children:[(0,s.jsxs)("div",{className:"gaming-card max-w-md w-full mx-auto space-y-8",children:[l&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm rounded-lg",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-purple-500/20 rounded-full animate-pulse"}),(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-t-purple-500 rounded-full animate-spin absolute inset-0"})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-center text-purple-400 mb-2",children:"Create Account"}),(0,s.jsx)("p",{className:"text-center text-gray-400",children:"Join the Galaxy Kick Lock community"})]}),(0,s.jsxs)("form",{onSubmit:d,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-purple-300 mb-2",children:[(0,s.jsx)(i.m9R,{}),"Username"]}),(0,s.jsx)("input",{type:"text",className:"gaming-input",value:r.username,onChange:e=>t({...r,username:e.target.value}),required:!0,minLength:3,maxLength:20,pattern:"[a-zA-Z0-9_-]+",title:"Username can only contain letters, numbers, underscores, and hyphens"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-purple-300 mb-2",children:[(0,s.jsx)(i.kUi,{}),"Password"]}),(0,s.jsx)("input",{type:"password",className:"gaming-input",value:r.password,onChange:e=>t({...r,password:e.target.value}),required:!0,minLength:6})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-purple-300 mb-2",children:[(0,s.jsx)(i.q2z,{}),"Access Token"]}),(0,s.jsx)("input",{type:"text",className:"gaming-input",value:r.token,onChange:e=>t({...r,token:e.target.value}),required:!0})]}),(0,s.jsx)("button",{type:"submit",className:"w-full gaming-button flex items-center justify-center gap-2",disabled:l,children:"Create Account"})]})]}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-hidden -z-10",children:[...Array(50)].map((e,r)=>(0,s.jsx)("div",{className:"star",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),animationDelay:"".concat(3*Math.random(),"s")}},r))})]})}},5611:function(e,r,t){"use strict";t.d(r,{bV:function(){return v},Gg:function(){return h},zB:function(){return f},w7:function(){return g},y1:function(){return m}});var s=t(4566),n=t(225),o=t(517);let i=null,a=async()=>{if(i)return i;try{let e=await o.ZP.load(),r=await e.get();return i=r.visitorId}catch(e){throw console.error("Error generating fingerprint:",e),Error("Failed to generate device fingerprint")}},c=(0,s.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4"),l=(0,s.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczMjM1MDMwMywiZXhwIjoyMDQ3OTI2MzAzfQ.50LNYYbfszw6IzHma3S6SIL53ZGFfVpj0Ty1x3ycj0o",{auth:{autoRefreshToken:!1,persistSession:!1}});async function u(e,r){try{console.log("Creating new session for user:",e);let t=(0,n.Z)(),{error:s}=await l.from("sessions").update({is_active:!1}).eq("user_id",e);if(s)throw console.error("Error deactivating existing sessions:",s),Error("Failed to deactivate existing sessions");await new Promise(e=>setTimeout(e,500));let{error:o}=await l.from("sessions").insert([{user_id:e,session_id:t,device_fingerprint:r,is_active:!0,created_at:new Date().toISOString(),last_active:new Date().toISOString()}]);if(o)throw console.error("Error creating session:",o),Error("Failed to create session");let{data:i,error:a}=await l.from("sessions").select("*").eq("user_id",e).eq("is_active",!0);if(a)throw console.error("Error checking active sessions:",a),Error("Failed to verify session creation");if(!i||0===i.length)throw Error("Failed to create session - no active sessions found");if(i.length>1){let r=i.reduce((e,r)=>new Date(r.created_at)>new Date(e.created_at)?r:e);if(await l.from("sessions").update({is_active:!1}).eq("user_id",e).neq("id",r.id),r.session_id!==t)throw Error("Another session was created simultaneously")}return console.log("Successfully created session with ID:",t),t}catch(e){throw console.error("Session creation error:",e),e}}async function d(e,r){try{console.log("Validating session:",{sessionId:e,userId:r});let t=await a(),{data:s,error:n}=await l.from("sessions").select("*").eq("session_id",e).eq("user_id",r).eq("is_active",!0).single();if(n)return console.error("Session validation error:",n),!1;if(!s)return console.log("No active session found"),!1;if(s.device_fingerprint!==t)return console.log("Device fingerprint mismatch"),await l.from("sessions").update({is_active:!1}).eq("session_id",e),!1;console.log("Found active session:",s);let{error:o}=await l.from("sessions").update({last_active:new Date().toISOString()}).eq("session_id",e);return o&&console.error("Error updating last_active:",o),!0}catch(e){return console.error("Unexpected error in validateSession:",e),!1}}async function f(e,r){try{let t;console.log("Starting sign in process for username:",e);let s=await a();if(console.log("Device fingerprint:",s),"Bharani"===e){if("HackerBharani"===r){let r=(0,n.Z)(),t={username:e,isLoggedIn:!0,isAdmin:!0,deviceFingerprint:s,sessionId:r,userId:"admin"};return p(t),t}throw Error("Invalid username or password")}let{data:o,error:i}=await c.from("users").select("*").eq("username",e).single();if(i||!o)throw console.error("User lookup error:",i),Error("Invalid username or password");let{data:d,error:f}=await l.from("sessions").select("*").eq("user_id",o.id).eq("is_active",!0);if(f)console.error("Error checking existing sessions:",f);else if(d&&d.length>0){let e=d[0];if(e.device_fingerprint!==s)throw Error("You are already logged in from another browser. Please sign out there first.")}try{t=await u(o.id,s),console.log("Created new session:",t)}catch(e){throw console.error("Failed to create session:",e),Error("Failed to create session. Please try again.")}let m={username:o.username,userId:o.id,isLoggedIn:!0,sessionId:t,token:o.token,deviceFingerprint:s,tokenExpiry:o.token_expiry};return p(m),m}catch(e){throw console.error("Sign in error:",e),e}}async function m(e,r,t){try{console.log("Starting sign up process for username:",e);let s=await a();console.log("Generated device fingerprint:",s);let{data:n,error:o}=await c.from("users").select("username").eq("username",e).single();if(o&&console.error("Error checking existing user:",o),n)throw Error("Username already exists");let{data:i,error:l}=await c.from("tokens").select("*").eq("token",t).single();if(l)throw console.error("Token verification error:",l),Error("Invalid token");if(!i)throw Error("Invalid token");if(i.is_used)throw Error("Token has already been used");let u={username:e,password:r,token:t,device_fingerprint:s,created_at:new Date().toISOString(),token_expiry:i.expiry_date};console.log("Attempting to create user with data:",{...u,password:"[REDACTED]",token:"[REDACTED]"});let{data:d,error:f}=await c.from("users").insert([u]).select().single();if(f)throw console.error("Detailed error creating user:",{message:f.message,details:f.details,hint:f.hint,code:f.code}),Error("Failed to create user account: ".concat(f.message));let{error:m}=await c.from("tokens").update({is_used:!0,used_by:e}).eq("token",t);return m&&console.error("Error updating token status:",m),console.log("Successfully created user:",{...d,password:"[REDACTED]",token:"[REDACTED]"}),{user:d,error:null}}catch(e){throw console.error("Sign up error:",e),e}}async function g(){try{let e=h();if((null==e?void 0:e.sessionId)&&(null==e?void 0:e.userId)){let{error:r}=await l.from("sessions").update({is_active:!1}).eq("session_id",e.sessionId).eq("user_id",e.userId);r&&console.error("Error ending session:",r)}}catch(e){console.error("Error during sign out:",e)}finally{w()}}function p(e){try{localStorage.setItem("session",JSON.stringify(e))}catch(e){console.error("Error saving session:",e)}}function h(){try{let e=localStorage.getItem("session");if(!e)return null;return JSON.parse(e)}catch(e){return console.error("Error reading session:",e),null}}function w(){localStorage.removeItem("session")}async function v(){let e=h();if(!e||!e.isLoggedIn)return null;if(e.isAdmin)return"Bharani"===e.username?e:(w(),null);try{console.log("Checking session for user:",e.username);let{data:r,error:t}=await c.from("users").select("*").eq("username",e.username).single();if(t){if(console.error("User lookup error:",t),"PGRST116"!==t.code)return e;throw w(),Error("Failed to verify user access")}if(!r)throw w(),Error("User not found or access revoked");let{data:s,error:n}=await c.from("tokens").select("*").eq("token",r.token).single();if(n&&(console.error("Token lookup error:",n),"PGRST116"!==n.code))return e;if(!s)throw w(),Error("Invalid token. Please contact admin.");let o=new Date(s.expiry_date);if(o<new Date)throw w(),Error("Your access token has expired. Please contact admin for renewal.");if(!s.is_used)throw w(),Error("Your token has been deactivated. Please contact admin to reactivate.");if(e.sessionId&&e.userId){let r=await d(e.sessionId,e.userId);if(!r)return console.warn("Session validation failed, but keeping session active"),e}let i={...e,username:r.username,userId:r.id,isLoggedIn:!0,isAdmin:!1,token:r.token,deviceFingerprint:e.deviceFingerprint};return p(i),i}catch(e){throw console.error("Session check error:",e),(e.message.includes("revoked")||e.message.includes("expired")||e.message.includes("deactivated"))&&w(),e}}},4033:function(e,r,t){e.exports=t(94)},1172:function(e,r,t){"use strict";t.d(r,{w_:function(){return c}});var s=t(2265),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=s.createContext&&s.createContext(n),i=function(){return(i=Object.assign||function(e){for(var r,t=1,s=arguments.length;t<s;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e}).apply(this,arguments)},a=function(e,r){var t={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&0>r.indexOf(s)&&(t[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)0>r.indexOf(s[n])&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(t[s[n]]=e[s[n]]);return t};function c(e){return function(r){return s.createElement(l,i({attr:i({},e.attr)},r),function e(r){return r&&r.map(function(r,t){return s.createElement(r.tag,i({key:t},r.attr),e(r.child))})}(e.child))}}function l(e){var r=function(r){var t,n=e.attr,o=e.size,c=e.title,l=a(e,["attr","size","title"]),u=o||r.size||"1em";return r.className&&(t=r.className),e.className&&(t=(t?t+" ":"")+e.className),s.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,l,{className:t,style:i(i({color:e.color||r.color},r.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),c&&s.createElement("title",null,c),e.children)};return void 0!==o?s.createElement(o.Consumer,null,function(e){return r(e)}):r(n)}}},function(e){e.O(0,[420,638,971,472,744],function(){return e(e.s=3063)}),_N_E=e.O()}]);