exports.id=520,exports.ids=[520],exports.modules={6261:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,3579,23)),Promise.resolve().then(s.t.bind(s,619,23)),Promise.resolve().then(s.t.bind(s,1459,23)),Promise.resolve().then(s.t.bind(s,3456,23)),Promise.resolve().then(s.t.bind(s,847,23)),Promise.resolve().then(s.t.bind(s,7303,23))},4648:(e,r,s)=>{Promise.resolve().then(s.bind(s,5256)),Promise.resolve().then(s.bind(s,2191))},2191:(e,r,s)=>{"use strict";s.r(r),s.d(r,{SessionProvider:()=>g,useSession:()=>u});var o=s(3854),n=s(4218),t=s(1018),i=s(2874),a=s(5256),l=s(2441);let c=(0,l.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4"),d=(0,n.createContext)({isLoading:!0,isAuthenticated:!1,isAdmin:!1,username:null,token:null}),u=()=>(0,n.useContext)(d);function g({children:e}){let[r,s]=(0,n.useState)(!0),[l,u]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null),[h,I]=(0,n.useState)(null),w=(0,t.useRouter)(),v=(0,t.usePathname)(),y=async e=>{console.log("Real-time change detected:",e);let r=JSON.parse(localStorage.getItem("session")||"{}");if(r&&r.username){if("DELETE"===e.eventType&&e.old_record&&e.old_record.username===r.username){console.log("User deleted, showing notification"),localStorage.removeItem("session"),u(!1),f(!1),p(null),I(null),a.toast.remove(),a.toast.error("Your access has been revoked by admin",{duration:5e3,position:"top-center",style:{background:"#ff4b4b",color:"#fff",fontSize:"16px",padding:"16px",maxWidth:"500px",textAlign:"center"}}),w.replace("/");return}if("UPDATE"===e.eventType&&e.old_record.username===r.username&&(!e.new_record.token||e.new_record.token!==e.old_record.token)){console.log("Token modified, showing notification"),localStorage.removeItem("session"),u(!1),f(!1),p(null),I(null),a.toast.remove(),a.toast.error("Your access token has been modified by admin",{duration:5e3,position:"top-center",style:{background:"#ff4b4b",color:"#fff",fontSize:"16px",padding:"16px",maxWidth:"500px",textAlign:"center"}}),w.replace("/");return}e.new_record&&e.new_record.username===r.username&&b()}},S=async e=>{let r=JSON.parse(localStorage.getItem("session")||"{}");r&&r.sessionId&&(console.log("Session change detected:",{eventType:e.eventType,currentSessionId:r.sessionId,payloadSessionId:e.new_record?.session_id,userId:r.userId}),("INSERT"===e.eventType||"UPDATE"===e.eventType)&&e.new_record.user_id===r.userId&&e.new_record.session_id!==r.sessionId&&(console.log("Another session detected, checking if it is newer"),e.new_record.is_active&&new Date(e.new_record.created_at)>new Date(r.created_at)&&(console.log("Newer active session found, invalidating current session"),localStorage.removeItem("session"),u(!1),f(!1),p(null),I(null),a.toast.error("Your session has ended because you signed in from another browser",{duration:5e3,position:"top-center",style:{background:"#ff4b4b",color:"#fff",fontSize:"16px",padding:"16px",maxWidth:"500px",textAlign:"center"}}),w.replace("/signin"))),"UPDATE"!==e.eventType||e.old_record.session_id!==r.sessionId||e.new_record.is_active||(console.log("Current session was deactivated"),localStorage.removeItem("session"),u(!1),f(!1),p(null),I(null),a.toast.error("Your session was deactivated",{duration:5e3,position:"top-center",style:{background:"#ff4b4b",color:"#fff",fontSize:"16px",padding:"16px",maxWidth:"500px",textAlign:"center"}}),w.replace("/signin")))},b=async()=>{try{console.log("Starting session validation");let e=await (0,i.bV)();e?(console.log("Session validated successfully:",{...e,token:"[REDACTED]"}),u(!0),f(e.isAdmin),p(e.username),I(e.token||null),e.isAdmin?"/"===v&&w.push("/admin"):v.startsWith("/admin")&&w.replace("/")):(console.log("No valid session found"),u(!1),f(!1),p(null),I(null),"/signin"!==v&&"/signup"!==v&&w.replace("/signin"))}catch(e){console.error("Session validation error:",e),u(!1),f(!1),p(null),I(null),a.toast.error(e.message||"Session validation failed",{duration:5e3,position:"top-center"}),"/signin"!==v&&"/signup"!==v&&w.replace("/signin")}finally{s(!1)}};return(0,n.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("session")||"{}");if(!e||!e.userId)return;console.log("Setting up real-time subscriptions for user:",e.userId);let r=c.channel("db-changes").on("postgres_changes",{event:"*",schema:"public",table:"users",filter:`username=eq.${e.username}`},y).on("postgres_changes",{event:"*",schema:"public",table:"sessions",filter:`user_id=eq.${e.userId}`},S).subscribe(e=>{console.log("Subscription status:",e)});return b(),()=>{console.log("Cleaning up subscriptions"),r.unsubscribe()}},[v]),(0,n.useEffect)(()=>{let e,r=!0,s=async()=>{if(r){try{await b()}catch(e){console.error("Validation error:",e),"/signin"!==v&&(a.toast.error(e.message,{duration:5e3,position:"top-center"}),w.replace("/"))}e=setTimeout(s,3e3)}};return s(),()=>{r=!1,clearTimeout(e)}},[v]),o.jsx(d.Provider,{value:{isLoading:r,isAuthenticated:l,isAdmin:g,username:m,token:h},children:e})}},2874:(e,r,s)=>{"use strict";s.d(r,{bV:()=>w,Gg:()=>h,zB:()=>g,w7:()=>m,y1:()=>f});var o=s(2441),n=s(5873),t=s(2887);let i=null,a=async()=>{if(i)return i;try{let e=await t.ZP.load(),r=await e.get();return i=r.visitorId}catch(e){throw console.error("Error generating fingerprint:",e),Error("Failed to generate device fingerprint")}},l=(0,o.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4"),c=(0,o.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczMjM1MDMwMywiZXhwIjoyMDQ3OTI2MzAzfQ.50LNYYbfszw6IzHma3S6SIL53ZGFfVpj0Ty1x3ycj0o",{auth:{autoRefreshToken:!1,persistSession:!1}});async function d(e,r){try{console.log("Creating new session for user:",e);let s=(0,n.Z)(),{error:o}=await c.from("sessions").update({is_active:!1}).eq("user_id",e);if(o)throw console.error("Error deactivating existing sessions:",o),Error("Failed to deactivate existing sessions");await new Promise(e=>setTimeout(e,500));let{error:t}=await c.from("sessions").insert([{user_id:e,session_id:s,device_fingerprint:r,is_active:!0,created_at:new Date().toISOString(),last_active:new Date().toISOString()}]);if(t)throw console.error("Error creating session:",t),Error("Failed to create session");let{data:i,error:a}=await c.from("sessions").select("*").eq("user_id",e).eq("is_active",!0);if(a)throw console.error("Error checking active sessions:",a),Error("Failed to verify session creation");if(!i||0===i.length)throw Error("Failed to create session - no active sessions found");if(i.length>1){let r=i.reduce((e,r)=>new Date(r.created_at)>new Date(e.created_at)?r:e);if(await c.from("sessions").update({is_active:!1}).eq("user_id",e).neq("id",r.id),r.session_id!==s)throw Error("Another session was created simultaneously")}return console.log("Successfully created session with ID:",s),s}catch(e){throw console.error("Session creation error:",e),e}}async function u(e,r){try{console.log("Validating session:",{sessionId:e,userId:r});let s=await a(),{data:o,error:n}=await c.from("sessions").select("*").eq("session_id",e).eq("user_id",r).eq("is_active",!0).single();if(n)return console.error("Session validation error:",n),!1;if(!o)return console.log("No active session found"),!1;if(o.device_fingerprint!==s)return console.log("Device fingerprint mismatch"),await c.from("sessions").update({is_active:!1}).eq("session_id",e),!1;console.log("Found active session:",o);let{error:t}=await c.from("sessions").update({last_active:new Date().toISOString()}).eq("session_id",e);return t&&console.error("Error updating last_active:",t),!0}catch(e){return console.error("Unexpected error in validateSession:",e),!1}}async function g(e,r){try{let s;console.log("Starting sign in process for username:",e);let o=await a();if(console.log("Device fingerprint:",o),"Bharani"===e){if("HackerBharani"===r){let r=(0,n.Z)(),s={username:e,isLoggedIn:!0,isAdmin:!0,deviceFingerprint:o,sessionId:r,userId:"admin"};return p(s),s}throw Error("Invalid username or password")}let{data:t,error:i}=await l.from("users").select("*").eq("username",e).single();if(i||!t)throw console.error("User lookup error:",i),Error("Invalid username or password");let{data:u,error:g}=await c.from("sessions").select("*").eq("user_id",t.id).eq("is_active",!0);if(g)console.error("Error checking existing sessions:",g);else if(u&&u.length>0){let e=u[0];if(e.device_fingerprint!==o)throw Error("You are already logged in from another browser. Please sign out there first.")}try{s=await d(t.id,o),console.log("Created new session:",s)}catch(e){throw console.error("Failed to create session:",e),Error("Failed to create session. Please try again.")}let f={username:t.username,userId:t.id,isLoggedIn:!0,sessionId:s,token:t.token,deviceFingerprint:o,tokenExpiry:t.token_expiry};return p(f),f}catch(e){throw console.error("Sign in error:",e),e}}async function f(e,r,s){try{console.log("Starting sign up process for username:",e);let o=await a();console.log("Generated device fingerprint:",o);let{data:n,error:t}=await l.from("users").select("username").eq("username",e).single();if(t&&console.error("Error checking existing user:",t),n)throw Error("Username already exists");let{data:i,error:c}=await l.from("tokens").select("*").eq("token",s).single();if(c)throw console.error("Token verification error:",c),Error("Invalid token");if(!i)throw Error("Invalid token");if(i.is_used)throw Error("Token has already been used");let d={username:e,password:r,token:s,device_fingerprint:o,created_at:new Date().toISOString(),token_expiry:i.expiry_date};console.log("Attempting to create user with data:",{...d,password:"[REDACTED]",token:"[REDACTED]"});let{data:u,error:g}=await l.from("users").insert([d]).select().single();if(g)throw console.error("Detailed error creating user:",{message:g.message,details:g.details,hint:g.hint,code:g.code}),Error(`Failed to create user account: ${g.message}`);let{error:f}=await l.from("tokens").update({is_used:!0,used_by:e}).eq("token",s);return f&&console.error("Error updating token status:",f),console.log("Successfully created user:",{...u,password:"[REDACTED]",token:"[REDACTED]"}),{user:u,error:null}}catch(e){throw console.error("Sign up error:",e),e}}async function m(){try{let e=h();if(e?.sessionId&&e?.userId){let{error:r}=await c.from("sessions").update({is_active:!1}).eq("session_id",e.sessionId).eq("user_id",e.userId);r&&console.error("Error ending session:",r)}}catch(e){console.error("Error during sign out:",e)}finally{I()}}function p(e){try{localStorage.setItem("session",JSON.stringify(e))}catch(e){console.error("Error saving session:",e)}}function h(){try{let e=localStorage.getItem("session");if(!e)return null;return JSON.parse(e)}catch(e){return console.error("Error reading session:",e),null}}function I(){localStorage.removeItem("session")}async function w(){let e=h();if(!e||!e.isLoggedIn)return null;if(e.isAdmin)return"Bharani"===e.username?e:(I(),null);try{console.log("Checking session for user:",e.username);let{data:r,error:s}=await l.from("users").select("*").eq("username",e.username).single();if(s){if(console.error("User lookup error:",s),"PGRST116"!==s.code)return e;throw I(),Error("Failed to verify user access")}if(!r)throw I(),Error("User not found or access revoked");let{data:o,error:n}=await l.from("tokens").select("*").eq("token",r.token).single();if(n&&(console.error("Token lookup error:",n),"PGRST116"!==n.code))return e;if(!o)throw I(),Error("Invalid token. Please contact admin.");let t=new Date(o.expiry_date);if(t<new Date)throw I(),Error("Your access token has expired. Please contact admin for renewal.");if(!o.is_used)throw I(),Error("Your token has been deactivated. Please contact admin to reactivate.");if(e.sessionId&&e.userId){let r=await u(e.sessionId,e.userId);if(!r)return console.warn("Session validation failed, but keeping session active"),e}let i={...e,username:r.username,userId:r.id,isLoggedIn:!0,isAdmin:!1,token:r.token,deviceFingerprint:e.deviceFingerprint};return p(i),i}catch(e){throw console.error("Session check error:",e),(e.message.includes("revoked")||e.message.includes("expired")||e.message.includes("deactivated"))&&I(),e}}},9124:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>f,metadata:()=>g});var o=s(4656),n=s(186),t=s.n(n);s(5023);var i=s(8204),a=s(5153);let l=(0,a.createProxy)(String.raw`D:\Workingfile\Galaxy\GalaxyWebsite\src\app\SessionProvider.tsx`),{__esModule:c,$$typeof:d}=l;l.default,(0,a.createProxy)(String.raw`D:\Workingfile\Galaxy\GalaxyWebsite\src\app\SessionProvider.tsx#useSession`);let u=(0,a.createProxy)(String.raw`D:\Workingfile\Galaxy\GalaxyWebsite\src\app\SessionProvider.tsx#SessionProvider`),g={title:"Galaxy Kick Lock",description:"Secure gaming authentication platform"};function f({children:e}){return o.jsx("html",{lang:"en",children:o.jsx("body",{className:t().className,children:(0,o.jsxs)(u,{children:[e,o.jsx(i.x7,{position:"top-right",toastOptions:{style:{background:"#1a1a1a",color:"#fff",border:"2px solid #9333ea"}}})]})})})}},5023:()=>{}};