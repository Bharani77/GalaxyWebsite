(()=>{var e={};e.id=3,e.ids=[3],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},1696:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>d});var s=r(7096),a=r(6132),n=r(7284),l=r.n(n),o=r(2564),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);r.d(t,i);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,881)),"D:\\Workingfile\\Galaxy\\GalaxyWebsite\\src\\app\\admin\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9124)),"D:\\Workingfile\\Galaxy\\GalaxyWebsite\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\Workingfile\\Galaxy\\GalaxyWebsite\\src\\app\\admin\\page.tsx"],x="/admin/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7556:(e,t,r)=>{Promise.resolve().then(r.bind(r,7149))},7149:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var s=r(3854),a=r(4218),n=r(1018),l=r(1830),o=r(5256),i=r(2874),d=r(2441);let c=(0,d.eI)("https://scxxvniczlyzyumuiohc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjeHh2bmljemx5enl1bXVpb2hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzIzNTAzMDMsImV4cCI6MjA0NzkyNjMwM30.AM5S6xAISMEH41V7pLsJSznd-b2hiene5ZGOClgZh-4");function x(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)(null),[d,x]=(0,a.useState)(!0),[u,m]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[g,f]=(0,a.useState)({username:"",password:""});(0,a.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("adminSession");e?(r(!0),await y()):r(!1)}catch(e){console.error("Session check error:",e),r(!1)}finally{x(!1)}};e()},[]),(0,a.useEffect)(()=>{if(!t)return;let e=c.channel("users-channel").on("postgres_changes",{event:"*",schema:"public",table:"users"},e=>{console.log("Users change received:",e),y()}).subscribe(),r=c.channel("tokens-channel").on("postgres_changes",{event:"*",schema:"public",table:"tokens"},e=>{console.log("Tokens change received:",e),y()}).subscribe();return()=>{e.unsubscribe(),r.unsubscribe()}},[t]);let y=async()=>{try{let{data:e,error:t}=await c.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;let{data:r,error:s}=await c.from("tokens").select("*").order("created_at",{ascending:!1});if(s)throw s;let a=r.map(t=>({...t,is_used:e.some(e=>e.token===t.token),used_by:e.find(e=>e.token===t.token)?.username}));m(e||[]),p(a||[])}catch(e){console.error("Error fetching data:",e),o.default.error("Failed to refresh data")}},b=async()=>{try{let{data:e,error:t}=await c.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;m(e||[])}catch(e){console.error("Error fetching users:",e),o.default.error("Failed to refresh users")}},j=async()=>{try{let{data:e,error:t}=await c.from("tokens").select("*").order("created_at",{ascending:!1});if(t)throw t;p(e||[])}catch(e){console.error("Error fetching tokens:",e),o.default.error("Failed to refresh tokens")}},w=async e=>{e.preventDefault();try{let e=await (0,i.zB)(g.username,g.password);if(!e.isLoggedIn)throw Error("Invalid credentials");localStorage.setItem("adminSession","true"),r(!0),await y(),o.default.success("Welcome, Administrator")}catch(e){o.default.error(e.message||"Authentication failed")}},k=async e=>{try{let t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),r=new Date;switch(e){case"3month":r.setMonth(r.getMonth()+3);break;case"6month":r.setMonth(r.getMonth()+6);break;case"1year":r.setFullYear(r.getFullYear()+1)}let{error:s}=await c.from("tokens").insert([{token:t,duration:e,expiry_date:r.toISOString(),is_used:!1,created_at:new Date().toISOString()}]);if(s)throw s;o.default.success("Token generated successfully"),y()}catch(e){console.error("Error generating token:",e),o.default.error("Failed to generate token")}},N=async t=>{try{let{data:r,error:s}=await c.from("users").select("token").eq("id",t).single();if(s)throw console.error("Error getting user data:",s),s;if(r?.token){let{error:e}=await c.from("tokens").delete().eq("token",r.token);if(e)throw console.error("Error deleting token:",e),e}let{error:a}=await c.from("users").delete().eq("id",t);if(a)throw a;let n=await c.auth.getSession(),l=n?.data?.session?.user;if(l&&l.id===t){await c.auth.signOut(),e.push("/");return}o.default.success("User and associated token deleted successfully"),y()}catch(e){console.error("Error deleting user:",e),o.default.error("Failed to delete user")}},v=async(t,r)=>{try{console.log("Deleting token:",r,"for user:",t);let{data:s,error:a}=await c.from("tokens").select("id").eq("token",r).single();if(a)throw console.error("Error finding token:",a),a;console.log("Found token data:",s);let{error:n}=await c.from("users").update({token:""}).eq("id",t);if(n)throw console.error("Error updating user:",n),n;console.log("Updated user token to empty string");let{error:l}=await c.from("tokens").delete().eq("id",s.id);if(l)throw console.error("Error deleting token:",l),l;console.log("Deleted token successfully");let i=await c.auth.getSession(),d=i?.data?.session?.user;if(d&&d.id===t){console.log("Admin deleted their own token, logging out..."),await c.auth.signOut(),e.push("/");return}o.default.success("Token deleted successfully"),await b(),await j()}catch(e){console.error("Failed to delete token:",e),o.default.error("Failed to delete token: "+(e.message||"Unknown error"))}},_=async e=>{try{let{error:t}=await c.from("tokens").delete().eq("id",e);if(t)throw t;o.default.success("Token deleted successfully"),j()}catch(e){console.error("Error deleting unused token:",e),o.default.error("Failed to delete token")}},S=async(e,t,r)=>{try{let s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),a=new Date;switch(r){case"3month":a.setMonth(a.getMonth()+3);break;case"6month":a.setMonth(a.getMonth()+6);break;case"1year":a.setFullYear(a.getFullYear()+1)}if(t){let{error:e}=await c.from("tokens").delete().eq("token",t);if(e)throw e}let{error:n}=await c.from("tokens").insert([{token:s,duration:r,expiry_date:a.toISOString(),is_used:!0,created_at:new Date().toISOString()}]);if(n)throw n;let{error:l}=await c.from("users").update({token:s}).eq("id",e);if(l)throw l;o.default.success("Token renewed successfully"),y()}catch(e){console.error("Error renewing token:",e),o.default.error("Failed to renew token")}},D=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),[q,E]=(0,a.useState)("3month"),[M,I]=(0,a.useState)(null),C=async()=>{try{let{data:e,error:t}=await c.from("users").select("*").not("token","is",null);if(t)throw t;let r=new Date().getTime();for(let t of e)if(t.token&&t.expiry_date){let e=new Date(t.expiry_date).getTime();if(r>e){console.log(`Token expired for user: ${t.username}`);let{error:e}=await c.from("users").update({token:null,expiry_date:null}).eq("id",t.id);e&&console.error("Error updating expired token:",e);let{error:r}=await c.from("tokens").delete().eq("token",t.token);r&&console.error("Error deleting expired token:",r)}}}catch(e){console.error("Error handling expired tokens:",e)}};if((0,a.useEffect)(()=>{C();let e=setInterval(C,6e4);return()=>clearInterval(e)},[]),d)return s.jsx("main",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"gaming-card max-w-md w-full mx-auto space-y-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"text-4xl font-bold text-red-500 mb-2",children:"Admin Access"}),s.jsx("p",{className:"text-gray-400",children:"Secure administration portal"})]}),s.jsx("div",{className:"text-center",children:s.jsx("p",{className:"text-gray-400",children:"Loading..."})})]})});if(!t)return s.jsx("main",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"gaming-card max-w-md w-full mx-auto space-y-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"text-4xl font-bold text-red-500 mb-2",children:"Admin Access"}),s.jsx("p",{className:"text-gray-400",children:"Secure administration portal"})]}),(0,s.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-red-400 mb-2",children:[s.jsx(l.KE5,{}),"Username"]}),s.jsx("input",{type:"text",className:"gaming-input",value:g.username,onChange:e=>f({...g,username:e.target.value}),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-red-400 mb-2",children:[s.jsx(l.kUi,{}),"Password"]}),s.jsx("input",{type:"password",className:"gaming-input",value:g.password,onChange:e=>f({...g,password:e.target.value}),required:!0})]}),s.jsx("button",{type:"submit",className:"gaming-button w-full",children:"Access Control Center"})]})]})});let A=h.reduce((e,t)=>{let r=t.duration;return e[r]||(e[r]=[]),e[r].push(t),e},{});return s.jsx("main",{className:"min-h-screen p-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[s.jsx("div",{className:"gaming-card",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx(l.KE5,{className:"text-blue-400 text-4xl"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-red-400 relative",children:["Admin Control Center",s.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-blue-500 via-red-500 to-blue-500 rounded-full shadow-lg"})]}),s.jsx("p",{className:"text-gray-400",children:"Manage users and tokens"})]})]}),s.jsx("button",{onClick:()=>{localStorage.removeItem("adminSession"),r(!1),m([]),p([]),o.default.success("Logged out successfully")},className:"gaming-button px-4 py-2 bg-black/30 hover:bg-black/40 border border-blue-500/50",children:"Logout"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[300px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-red-400",children:"3 Month Tokens"}),s.jsx("button",{onClick:()=>k("3month"),className:"gaming-button px-4 py-2",children:"Generate"})]}),s.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:s.jsx("div",{className:"space-y-2",children:A["3month"]?.map(e=>{let t=e.is_used;return s.jsx("div",{className:`bg-black/30 p-3 rounded-lg text-sm ${t?"border border-red-500/50":"border border-green-500/50"}`,children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:t?"text-red-500":"text-green-500",children:e.token}),s.jsxs("p",{className:`text-sm ${t?"text-red-400":"text-gray-400"}`,children:["Status: ",t?"Used":"Available"]}),s.jsxs("p",{className:"text-gray-400",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),e.used_by&&s.jsxs("p",{className:"text-red-400 text-sm",children:["Used by: ",e.used_by]})]}),!t&&s.jsx("button",{onClick:()=>_(e.id),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:s.jsx(l.Xm5,{})})]})},e.id)})})})]}),(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[300px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-red-400",children:"6 Month Tokens"}),s.jsx("button",{onClick:()=>k("6month"),className:"gaming-button px-4 py-2",children:"Generate"})]}),s.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:s.jsx("div",{className:"space-y-2",children:A["6month"]?.map(e=>{let t=e.is_used;return s.jsx("div",{className:`bg-black/30 p-3 rounded-lg text-sm ${t?"border border-red-500/50":"border border-green-500/50"}`,children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:t?"text-red-500":"text-green-500",children:e.token}),s.jsxs("p",{className:`text-sm ${t?"text-red-400":"text-gray-400"}`,children:["Status: ",t?"Used":"Available"]}),s.jsxs("p",{className:"text-gray-400",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),e.used_by&&s.jsxs("p",{className:"text-red-400 text-sm",children:["Used by: ",e.used_by]})]}),!t&&s.jsx("button",{onClick:()=>_(e.id),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:s.jsx(l.Xm5,{})})]})},e.id)})})})]}),(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[300px] flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-red-400",children:"1 Year Tokens"}),s.jsx("button",{onClick:()=>k("1year"),className:"gaming-button px-4 py-2",children:"Generate"})]}),s.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:s.jsx("div",{className:"space-y-2",children:A["1year"]?.map(e=>{let t=e.is_used;return s.jsx("div",{className:`bg-black/30 p-3 rounded-lg text-sm ${t?"border border-red-500/50":"border border-green-500/50"}`,children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:t?"text-red-500":"text-green-500",children:e.token}),s.jsxs("p",{className:`text-sm ${t?"text-red-400":"text-gray-400"}`,children:["Status: ",t?"Used":"Available"]}),s.jsxs("p",{className:"text-gray-400",children:["Expires: ",new Date(e.expiry_date).toLocaleDateString()]}),e.used_by&&s.jsxs("p",{className:"text-red-400 text-sm",children:["Used by: ",e.used_by]})]}),!t&&s.jsx("button",{onClick:()=>_(e.id),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:s.jsx(l.Xm5,{})})]})},e.id)})})})]})]}),(0,s.jsxs)("div",{className:"gaming-card border-2 border-blue-500/70 h-[400px] flex flex-col",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-6",children:"Users & Tokens Management"}),s.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,s.jsxs)("table",{className:"w-full text-left",children:[s.jsx("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-red-500/20",children:[s.jsx("th",{className:"px-4 py-2 text-red-400",children:"S.No"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Username"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Duration"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Token"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Expire Date"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Created At"}),s.jsx("th",{className:"px-6 py-4 whitespace-nowrap",children:"User Status"}),s.jsx("th",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:"Token Expiry"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Device ID"}),s.jsx("th",{className:"px-4 py-2 text-red-400",children:"Actions"})]})}),s.jsx("tbody",{children:u.map((e,t)=>{let r=h.find(t=>t.token===e.token),a=M===e.id;return(0,s.jsxs)("tr",{className:`border-b border-red-500/10 ${e.token&&new Date(e.expiry_date)>new Date?"text-green-500":""}`,children:[s.jsx("td",{className:"px-4 py-2 text-gray-400",children:t+1}),s.jsx("td",{className:"px-4 py-2 text-gray-400",children:e.username}),s.jsx("td",{className:"px-4 py-2 text-gray-400",children:r?.duration||"-"}),s.jsx("td",{className:"px-4 py-2 text-gray-400",children:e.token||"-"}),s.jsx("td",{className:"px-4 py-2 text-gray-400",children:r?.expiry_date?s.jsx("span",{className:new Date(r.expiry_date)<new Date?"text-red-500":"",children:new Date(r.expiry_date).toLocaleDateString()}):"N/A"}),s.jsx("td",{className:"px-4 py-2 text-gray-400",children:D(e.created_at)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.token?new Date(e.expiry_date)<new Date?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.token?new Date(e.expiry_date)<new Date?"Expired":"Active":"No Access"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.expiry_date?s.jsx("span",{className:new Date(e.expiry_date)<new Date?"text-red-500":"",children:new Date(e.expiry_date).toLocaleDateString()}):"N/A"}),s.jsx("td",{className:"px-4 py-2 text-gray-400",children:s.jsx("span",{className:"font-mono text-xs break-all",children:e.device_fingerprint||"Not registered"})}),(0,s.jsxs)("td",{className:"px-4 py-2 space-x-2 flex items-center",children:[s.jsx("button",{onClick:()=>N(e.id),className:"text-red-500 hover:text-red-400",title:"Delete User",children:s.jsx(l.Xm5,{})}),e.token&&""!==e.token&&s.jsx("button",{onClick:()=>v(e.id,e.token),className:"text-red-500 hover:text-red-400",title:"Delete Token",children:s.jsx(l.q2z,{})}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx("button",{onClick:()=>I(a?null:e.id),className:"text-yellow-500 hover:text-yellow-400",title:"Renew Token",children:s.jsx(l.lbL,{})}),a&&(0,s.jsxs)("div",{className:"absolute z-10 mt-2 w-48 bg-black/90 rounded-lg shadow-lg p-2 right-0",children:[(0,s.jsxs)("select",{value:q,onChange:e=>E(e.target.value),className:"w-full mb-2 bg-black/50 text-gray-300 rounded p-1 border border-gray-700",children:[s.jsx("option",{value:"3month",children:"3 Months"}),s.jsx("option",{value:"6month",children:"6 Months"}),s.jsx("option",{value:"1year",children:"1 Year"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("button",{onClick:()=>{S(e.id,e.token,q),I(null)},className:"bg-yellow-500 hover:bg-yellow-600 text-black px-3 py-1 rounded text-sm",children:"Renew"}),s.jsx("button",{onClick:()=>I(null),className:"bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm",children:"Cancel"})]})]})]})]})]},e.id)})})]})})]})]})})}},881:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>l,__esModule:()=>n,default:()=>i});var s=r(5153);let a=(0,s.createProxy)(String.raw`D:\Workingfile\Galaxy\GalaxyWebsite\src\app\admin\page.tsx`),{__esModule:n,$$typeof:l}=a,o=a.default,i=o}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[637,830,520],()=>r(1696));module.exports=s})();